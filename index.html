<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡πÄ‡∏Å‡∏°‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏π‡∏ì 2-12</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap');
    body { font-family: 'Kanit', sans-serif; }
    .bounce-in { animation: bounceIn 0.52s ease-out; }
    @keyframes bounceIn {
      0% { transform: scale(0.85); opacity: 0; }
      60% { transform: scale(1.02); }
      100% { transform: scale(1); opacity: 1; }
    }
    .pulse-correct { animation: pulseCorrect 0.6s ease-out; }
    @keyframes pulseCorrect {
      0% { transform: scale(1); }
      50% { transform: scale(1.06); }
      100% { transform: scale(1); }
    }
    .shake-wrong { animation: shakeWrong 0.5s ease-out; }
    @keyframes shakeWrong {
      0%,100%{ transform: translateX(0); }
      20%{ transform: translateX(-6px); }
      40%{ transform: translateX(6px); }
      60%{ transform: translateX(-4px); }
      80%{ transform: translateX(4px); }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-purple-400 via-pink-400 to-orange-400 min-h-screen">
  <!-- Home -->
  <div id="homeScreen" class="min-h-screen flex flex-col justify-center items-center p-4">
    <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md text-center bounce-in">
      <div class="text-6xl mb-4">üßÆ</div>
      <h1 class="text-3xl font-bold text-purple-600 mb-2">‡πÄ‡∏Å‡∏°‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏π‡∏ì</h1>
      <h2 class="text-2xl font-bold text-pink-500 mb-6">2 - 12 (10 ‡∏Ç‡πâ‡∏≠)</h2>

      <div class="mb-4">
        <input id="namePreview" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏° (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)" class="w-full p-3 rounded-xl border-2 border-purple-200 text-center focus:outline-none mb-2" />
        <div class="text-sm text-gray-600">‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</div>
      </div>

      <button id="btnStartHome" class="w-full bg-gradient-to-r from-green-400 to-blue-500 text-white text-xl font-bold py-3 rounded-2xl shadow-lg hover:shadow-xl mb-4">
        üéÆ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
      </button>

      <div class="bg-yellow-50 rounded-2xl p-4">
        <div class="flex justify-between items-center mb-3">
          <h3 class="text-lg font-bold text-orange-600">üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
          <button id="btnShowFullLB" class="text-sm text-blue-600 underline">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>
        <div id="leaderboard" class="space-y-2 text-left">
          <div class="text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Name screen -->
  <div id="nameScreen" class="min-h-screen flex flex-col justify-center items-center p-4 hidden">
    <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md text-center bounce-in">
      <div class="text-6xl mb-4">üëã</div>
      <h2 class="text-2xl font-bold text-purple-600 mb-4">‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>

      <input id="playerName" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å)" class="w-full p-4 rounded-2xl border-2 border-purple-300 mb-6 text-center focus:outline-none" />

      <button id="btnStart" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold py-3 rounded-2xl shadow-lg hover:shadow-xl">
        ‚ú® ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô
      </button>

      <button id="btnCancelName" class="mt-3 text-sm text-gray-600 underline">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
  </div>

  <!-- Game screen -->
  <div id="gameScreen" class="min-h-screen flex flex-col p-4 hidden">
    <div class="bg-white rounded-2xl shadow-lg p-4 mb-4 flex justify-between items-center">
      <div class="text-lg font-bold text-purple-600">‡∏Ç‡πâ‡∏≠ <span id="questionNumber">1</span>/10</div>
      <div class="text-lg font-bold text-orange-600">‚è±Ô∏è <span id="timer">00:00</span></div>
      <div class="text-lg font-bold text-green-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="score">0</span></div>
    </div>

    <div class="bg-white rounded-3xl shadow-2xl p-8 mb-6 text-center bounce-in">
      <div id="question" class="text-5xl font-bold text-purple-600 mb-4">2 √ó 3 = ?</div>
    </div>

    <div class="grid grid-cols-2 gap-4 flex-1 mb-6">
      <button id="opt0" class="answer-btn bg-gradient-to-br from-red-400 to-red-500 text-white text-2xl font-bold rounded-2xl shadow-lg min-h-[96px]"></button>
      <button id="opt1" class="answer-btn bg-gradient-to-br from-blue-400 to-blue-500 text-white text-2xl font-bold rounded-2xl shadow-lg min-h-[96px]"></button>
      <button id="opt2" class="answer-btn bg-gradient-to-br from-green-400 to-green-500 text-white text-2xl font-bold rounded-2xl shadow-lg min-h-[96px]"></button>
      <button id="opt3" class="answer-btn bg-gradient-to-br from-yellow-400 to-yellow-500 text-white text-2xl font-bold rounded-2xl shadow-lg min-h-[96px]"></button>
    </div>
  </div>

  <!-- Result screen -->
  <div id="resultScreen" class="min-h-screen flex flex-col justify-center items-center p-4 hidden">
    <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md text-center bounce-in">
      <div class="text-6xl mb-4">üéâ</div>
      <h2 class="text-2xl font-bold text-purple-600 mb-4">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!</h2>

      <div class="bg-gradient-to-r from-purple-100 to-pink-100 rounded-2xl p-6 mb-6">
        <div class="text-lg font-bold text-purple-600 mb-2">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: <span id="finalPlayerName"></span></div>
        <div class="text-lg font-bold text-green-600 mb-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="finalScore"></span>/10</div>
        <div class="text-lg font-bold text-orange-600">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: <span id="finalTime"></span></div>
      </div>

      <button id="btnPlayAgain" class="w-full bg-gradient-to-r from-green-400 to-blue-500 text-white text-xl font-bold py-3 rounded-2xl mb-3">üîÑ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
      <button id="btnReturnHome" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold py-3 rounded-2xl">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    </div>
  </div>

  <!-- Full leaderboard modal (simple) -->
  <div id="fullLeaderboard" class="fixed inset-0 bg-black/40 hidden items-center justify-center p-4">
    <div class="bg-white rounded-xl p-6 w-full max-w-lg">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold">Leaderboard ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <button id="closeFullLB" class="text-sm text-gray-600">‡∏õ‡∏¥‡∏î</button>
      </div>
      <div id="fullLBList" class="space-y-2 max-h-64 overflow-auto"></div>
    </div>
  </div>

<script>
/* ====== Config & State ====== */
const TOTAL_QUESTIONS = 10;
const BASES = [2,3,4,5,6,7,8,9,10,11,12]; // ‡πÅ‡∏°‡πà‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏π‡∏ì
let questions = [];
let currentIndex = 0;
let score = 0;
let playerName = '';
let startTime = 0;
let timerInterval = null;
const LB_KEY = 'multiplication_leaderboard_v2';

/* ====== Helpers ====== */
function shuffle(arr) {
  for (let i = arr.length -1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

/* ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å BASES ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥ (10 ‡∏Ñ‡πà‡∏≤) ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏∏‡πà‡∏° multiplier 1..12 */
function generateQuestions() {
  questions = [];
  const bases = shuffle([...BASES]).slice(0, TOTAL_QUESTIONS);
  bases.forEach(base => {
    const y = Math.floor(Math.random()*12) + 1; // 1..12
    const correct = base * y;
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á distractors ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
    const opts = new Set();
    opts.add(correct);
    while (opts.size < 4) {
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á: ¬±(1..12) ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ñ‡∏π‡∏ì/‡∏´‡∏≤‡∏£‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
      const r = Math.random();
      let candidate;
      if (r < 0.5) {
        const delta = Math.floor(Math.random()*12) + 1;
        candidate = correct + (Math.random() < 0.5 ? -delta : delta);
      } else {
        // ‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏•‡∏Ñ‡∏π‡∏ì‡∏à‡∏≤‡∏Å base ‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
        const altY = Math.max(1, Math.min(12, y + (Math.floor(Math.random()*3)-1)));
        candidate = base * altY;
      }
      if (candidate <= 0) continue;
      opts.add(candidate);
    }
    const arr = shuffle(Array.from(opts));
    questions.push({
      base, y,
      q: `${base} √ó ${y} = ?`,
      options: arr,
      correct: arr.indexOf(correct)
    });
  });
}

/* ====== UI Helpers ====== */
function show(el) { el.classList.remove('hidden'); }
function hide(el) { el.classList.add('hidden'); }

/* ====== Leaderboard storage & render ====== */
function loadLeaderboard() {
  return JSON.parse(localStorage.getItem(LB_KEY) || '[]');
}
function saveScoreToStorage(name, scoreVal, timeSec) {
  const list = loadLeaderboard();
  list.push({ name: name, score: scoreVal, time: timeSec, at: (new Date()).toISOString() });
  // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á: ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏°‡∏≤‡∏Å‡∏Å‡πà‡∏≠‡∏ô -> ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡πà‡∏≠‡∏ô
  list.sort((a,b) => { if (b.score !== a.score) return b.score - a.score; return a.time - b.time; });
  localStorage.setItem(LB_KEY, JSON.stringify(list));
}
function renderLeaderboardSnippet() {
  const list = loadLeaderboard();
  const container = document.getElementById('leaderboard');
  if (!list.length) {
    container.innerHTML = '<div class="text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>';
    return;
  }
  const top = list.slice(0,5);
  container.innerHTML = top.map((r, i) => {
    const min = Math.floor(r.time/60).toString().padStart(2,'0');
    const sec = (r.time%60).toString().padStart(2,'0');
    const medals = ['ü•á','ü•à','ü•â','4Ô∏è‚É£','5Ô∏è‚É£'];
    return `
      <div class="flex justify-between items-center bg-white rounded-lg p-2 text-sm">
        <div class="font-semibold">${medals[i] || (i+1)} ${escapeHtml(r.name)}</div>
        <div class="text-green-600">${r.score}/10</div>
        <div class="text-orange-600">${min}:${sec}</div>
      </div>
    `;
  }).join('');
}
function renderFullLeaderboard() {
  const list = loadLeaderboard();
  const container = document.getElementById('fullLBList');
  if (!list.length) {
    container.innerHTML = '<div class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>';
    return;
  }
  container.innerHTML = list.map((r, i) => {
    const min = Math.floor(r.time/60).toString().padStart(2,'0');
    const sec = (r.time%60).toString().padStart(2,'0');
    return `<div class="flex justify-between items-center p-2 border-b">
      <div class="text-sm"><span class="font-semibold">${i+1}.</span> ${escapeHtml(r.name)}</div>
      <div class="text-sm text-green-600">${r.score}/10</div>
      <div class="text-sm text-orange-600">${min}:${sec}</div>
    </div>`;
  }).join('');
}

/* small helper to avoid XSS when injecting names */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* ====== Game flow ====== */
const elHome = document.getElementById('homeScreen');
const elName = document.getElementById('nameScreen');
const elGame = document.getElementById('gameScreen');
const elResult = document.getElementById('resultScreen');
const elQuestion = document.getElementById('question');
const elQNum = document.getElementById('questionNumber');
const elScore = document.getElementById('score');
const elTimer = document.getElementById('timer');
const namePreview = document.getElementById('namePreview');

const optButtons = [
  document.getElementById('opt0'),
  document.getElementById('opt1'),
  document.getElementById('opt2'),
  document.getElementById('opt3')
];

document.getElementById('btnStartHome').addEventListener('click', () => {
  // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ (‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
  const preview = namePreview.value && namePreview.value.trim();
  document.getElementById('playerName').value = preview || '';
  hide(elHome); show(elName);
});
document.getElementById('btnCancelName').addEventListener('click', () => {
  hide(elName); show(elHome);
});

document.getElementById('btnStart').addEventListener('click', () => {
  const val = document.getElementById('playerName').value.trim();
  if (!val) {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
    return;
  }
  playerName = val;
  startGame();
});

document.getElementById('btnReturnHome').addEventListener('click', () => {
  hide(elResult); show(elHome); renderLeaderboardSnippet();
});
document.getElementById('btnPlayAgain').addEventListener('click', () => {
  hide(elResult); show(elName);
});

document.getElementById('btnShowFullLB').addEventListener('click', () => {
  renderFullLeaderboard();
  show(document.getElementById('fullLeaderboard'));
});
document.getElementById('closeFullLB').addEventListener('click', () => {
  hide(document.getElementById('fullLeaderboard'));
});

/* attach handlers for options */
optButtons.forEach((btn, idx) => {
  btn.addEventListener('click', () => handleAnswer(idx));
});

function startGame(){
  hide(elHome); hide(elName); show(elGame);
  generateQuestions();
  currentIndex = 0; score = 0;
  startTime = Date.now();
  elScore.textContent = '0';
  renderQuestion();
  startTimer();
}

function renderQuestion(){
  if (currentIndex >= TOTAL_QUESTIONS) {
    finishGame();
    return;
  }
  const q = questions[currentIndex];
  elQuestion.textContent = q.q;
  elQNum.textContent = (currentIndex+1).toString();
  elScore.textContent = score.toString();
  // fill buttons
  q.options.forEach((opt, i) => {
    const btn = optButtons[i];
    btn.textContent = opt;
    btn.disabled = false;
    btn.classList.remove('pulse-correct', 'shake-wrong', 'opacity-40');
  });
}

function handleAnswer(selectedIdx){
  // disable to prevent multi-click
  optButtons.forEach(b => b.disabled = true);

  const q = questions[currentIndex];
  const correctIdx = q.correct;
  // mark selected
  if (selectedIdx === correctIdx) {
    score++;
    optButtons[selectedIdx].classList.add('pulse-correct');
  } else {
    optButtons[selectedIdx].classList.add('shake-wrong');
    optButtons[correctIdx].classList.add('pulse-correct');
  }
  elScore.textContent = score.toString();

  // wait a bit to show effect, then next question
  setTimeout(() => {
    currentIndex++;
    if (currentIndex < TOTAL_QUESTIONS) {
      renderQuestion();
    } else {
      finishGame();
    }
  }, 600);
}

function startTimer(){
  if (timerInterval) clearInterval(timerInterval);
  elTimer.textContent = '00:00';
  timerInterval = setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime)/1000);
    const m = Math.floor(elapsed/60).toString().padStart(2,'0');
    const s = (elapsed%60).toString().padStart(2,'0');
    elTimer.textContent = `${m}:${s}`;
  }, 200);
}

function finishGame(){
  if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
  const totalSec = Math.floor((Date.now() - startTime)/1000);
  // show result
  hide(elGame); show(elResult);
  document.getElementById('finalPlayerName').textContent = playerName;
  document.getElementById('finalScore').textContent = score.toString();
  const mm = Math.floor(totalSec/60).toString().padStart(2,'0');
  const ss = (totalSec%60).toString().padStart(2,'0');
  document.getElementById('finalTime').textContent = `${mm}:${ss}`;
  // save
  saveScoreToStorage(playerName, score, totalSec);
  renderLeaderboardSnippet();
}

/* ====== on load ====== */
renderLeaderboardSnippet();

/* ====== end ====== */
</script>
</body>
</html>
